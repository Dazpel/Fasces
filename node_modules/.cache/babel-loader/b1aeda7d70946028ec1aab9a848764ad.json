{"ast":null,"code":"var _jsxFileName = \"/home/alexander/Desktop/Ironhack/Paxanimi/src/Components/ReceiptView/Receipt.jsx\";\nimport React, { Component } from 'react';\nimport { saveReceipt, receiptListArr, updateReceiptArr } from '../firebase/firebase.utils';\nimport axios from 'axios';\nimport ReceiptTable from './ReceiptTable'; //API KEY FOR OCR SCAN\n\nlet MY_URL_KEY = '31bb9650994211eab7efc1191d38e165';\nexport default class Receipt extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      imageUrl: ''\n    };\n\n    this.getReceiptData = async ({\n      url,\n      id\n    }) => {\n      let file = {\n        url: url,\n        headers: {\n          'x-custom-key': 'string'\n        }\n      };\n      axios.post('https://api.taggun.io/api/receipt/v1/simple/url', file, {\n        headers: {\n          apikey: MY_URL_KEY\n        }\n      }).then(function (response) {\n        //  IF SUCCESSFULL SAVE THE DATA TO FIREBASE\n        updateReceiptArr(id, url, response.data.totalAmount.data);\n      }).catch(function (error) {\n        console.log(error);\n      }); //CLEAN STATE FOR ANOTHER IMAGE TO BE UPLOADED IF NEEDED\n\n      console.log('at', this.state.imageArr.length);\n      this.setState({\n        imageUrl: '' // imageArr: await receiptListArr(),\n\n      });\n    };\n\n    this.uploadAndScan = async url => {\n      console.log(url);\n      await this.getReceiptData(url);\n    };\n\n    this.handleFileUpload = e => {\n      //CLOUDINARY CONFIG VALUES\n      const cloudName = 'dsxn0sfql';\n      const preset = 'w8mpx9l6';\n      let imgFile = e.target.files[0];\n      var url = `https://api.cloudinary.com/v1_1/${cloudName}/upload`;\n      var xhr = new XMLHttpRequest();\n      var fd = new FormData();\n      xhr.open('POST', url, true);\n      xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');\n\n      xhr.onreadystatechange = e => {\n        if (xhr.readyState == 4 && xhr.status == 200) {\n          // File uploaded successfully\n          var response = JSON.parse(xhr.responseText);\n          var url = response.secure_url;\n          var id = response.asset_id; // UPDATE STATE WITH IMAGE URL AND ID\n\n          this.setState({\n            imageUrl: {\n              url: url,\n              id: id\n            }\n          });\n        }\n      }; //POST REQUEST FIELDS\n\n\n      fd.append('upload_preset', preset);\n      fd.append('tags', 'browser_upload'); // Optional - add tag for image admin in Cloudinary\n\n      fd.append('file', imgFile);\n      xhr.send(fd);\n    };\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 99,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      onClick: () => this.uploadAndScan(this.state.imageUrl),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 101,\n        columnNumber: 9\n      }\n    }, \"Upload\"), /*#__PURE__*/React.createElement(\"input\", {\n      type: \"file\",\n      onChange: e => this.handleFileUpload(e),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 104,\n        columnNumber: 9\n      }\n    }));\n  }\n\n}","map":{"version":3,"sources":["/home/alexander/Desktop/Ironhack/Paxanimi/src/Components/ReceiptView/Receipt.jsx"],"names":["React","Component","saveReceipt","receiptListArr","updateReceiptArr","axios","ReceiptTable","MY_URL_KEY","Receipt","state","imageUrl","getReceiptData","url","id","file","headers","post","apikey","then","response","data","totalAmount","catch","error","console","log","imageArr","length","setState","uploadAndScan","handleFileUpload","e","cloudName","preset","imgFile","target","files","xhr","XMLHttpRequest","fd","FormData","open","setRequestHeader","onreadystatechange","readyState","status","JSON","parse","responseText","secure_url","asset_id","append","send","render"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport { saveReceipt, receiptListArr, updateReceiptArr } from '../firebase/firebase.utils';\nimport axios from 'axios';\nimport ReceiptTable from './ReceiptTable';\n\n//API KEY FOR OCR SCAN\nlet MY_URL_KEY = '31bb9650994211eab7efc1191d38e165';\n\nexport default class Receipt extends Component {\n  state = {\n    imageUrl: '',\n  \n  };\n\n\n  \n\n  //IN THIS FUNCTION WE MAKE A CALL TO THE ACR SCAN API AND WE PASS THE DATA WE RECIEVE TO\n  //FIREBASE FOR STORAGE\n  getReceiptData = async ({ url, id }) => {\n    \n    let file = {\n      url: url,\n      headers: {\n        'x-custom-key': 'string',\n      },\n    };\n\n    axios\n      .post('https://api.taggun.io/api/receipt/v1/simple/url', file, {\n        headers: {\n          apikey: MY_URL_KEY,\n        },\n      })\n      .then(function (response) {\n        //  IF SUCCESSFULL SAVE THE DATA TO FIREBASE\n        updateReceiptArr(id, url, response.data.totalAmount.data);\n      })\n      .catch(function (error) {\n        console.log(error);\n      });\n\n    //CLEAN STATE FOR ANOTHER IMAGE TO BE UPLOADED IF NEEDED\n    console.log('at', this.state.imageArr.length)\n    this.setState({\n      imageUrl: '',\n      // imageArr: await receiptListArr(),\n    });\n\n    \n\n  };\n\n  //TRIGGER THE OCR SCAN FUNCTION\n  uploadAndScan = async (url) => {\n    console.log(url);\n    await this.getReceiptData(url);\n\n  };\n\n  //UPLOAD FILE TO CLOUDINARY AND GET THE IMG URL AND ID\n  handleFileUpload = (e) => {\n    //CLOUDINARY CONFIG VALUES\n    const cloudName = 'dsxn0sfql';\n    const preset = 'w8mpx9l6';\n    let imgFile = e.target.files[0];\n\n    var url = `https://api.cloudinary.com/v1_1/${cloudName}/upload`;\n    var xhr = new XMLHttpRequest();\n    var fd = new FormData();\n    xhr.open('POST', url, true);\n    xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');\n\n    xhr.onreadystatechange = (e) => {\n      if (xhr.readyState == 4 && xhr.status == 200) {\n        // File uploaded successfully\n        var response = JSON.parse(xhr.responseText);\n\n        var url = response.secure_url;\n        var id = response.asset_id;\n        // UPDATE STATE WITH IMAGE URL AND ID\n        this.setState({\n          imageUrl: {\n            url: url,\n            id: id,\n          },\n        });\n      }\n    };\n    //POST REQUEST FIELDS\n    fd.append('upload_preset', preset);\n    fd.append('tags', 'browser_upload'); // Optional - add tag for image admin in Cloudinary\n    fd.append('file', imgFile);\n    xhr.send(fd);\n  };\n\n  render() {\n    return (\n      <div>\n        {/* <ReceiptTable imageArr = {this.state.imageArr}/> */}\n        <button onClick={() => this.uploadAndScan(this.state.imageUrl)}>\n          Upload\n        </button>\n        <input type=\"file\" onChange={(e) => this.handleFileUpload(e)} />\n      </div>\n    );\n  }\n}\n"]},"metadata":{},"sourceType":"module"}